(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{28519:function(t,e,n){var r=n(30419),o=n(17806);t.exports=function(t,e){var n=-1,i=o(t)?Array(t.length):[];return r(t,function(t,r,o){i[++n]=e(t,r,o)}),i}},66738:function(t,e,n){var r=n(68165),o=n(29013),i=n(37942),a=n(28519),s=n(642),c=n(66127),l=n(8869),u=n(15502),f=n(60443);t.exports=function(t,e,n){e=e.length?r(e,function(t){return f(t)?function(e){return o(e,1===t.length?t[0]:t)}:t}):[u];var d=-1;return e=r(e,c(i)),s(a(t,function(t,n,o){return{criteria:r(e,function(e){return e(t)}),index:++d,value:t}}),function(t,e){return l(t,e,n)})}},642:function(t){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},95166:function(t,e,n){var r=n(38149),o=n(55648),i=n(32874);t.exports=function(t,e,n){var a=t.length;if(a<2)return a?i(t[0]):[];for(var s=-1,c=Array(a);++s<a;)for(var l=t[s],u=-1;++u<a;)u!=s&&(c[s]=r(c[s]||l,t[u],e,n));return i(o(c,1),e,n)}},43425:function(t,e,n){var r=n(41108);t.exports=function(t,e){if(t!==e){var n=void 0!==t,o=null===t,i=t==t,a=r(t),s=void 0!==e,c=null===e,l=e==e,u=r(e);if(!c&&!u&&!a&&t>e||a&&s&&l&&!c&&!u||o&&s&&l||!n&&l||!i)return 1;if(!o&&!a&&!u&&t<e||u&&n&&i&&!o&&!a||c&&n&&i||!s&&i||!l)return -1}return 0}},8869:function(t,e,n){var r=n(43425);t.exports=function(t,e,n){for(var o=-1,i=t.criteria,a=e.criteria,s=i.length,c=n.length;++o<s;){var l=r(i[o],a[o]);if(l){if(o>=c)return l;return l*("desc"==n[o]?-1:1)}}return t.index-e.index}},60679:function(t,e,n){var r=n(27087),o=n(17806),i=n(41056),a=n(63117);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return("number"==s?!!(o(n)&&i(e,n.length)):"string"==s&&e in n)&&r(n[e],t)}},60229:function(t,e,n){var r=n(55648),o=n(66738),i=n(48674),a=n(60679),s=i(function(t,e){if(null==t)return[];var n=e.length;return n>1&&a(t,e[0],e[1])?e=[]:n>2&&a(e[0],e[1],e[2])&&(e=[e[0]]),o(t,r(e,1),[])});t.exports=s},9488:function(t,e,n){var r=n(19206),o=n(48674),i=n(95166),a=n(65767),s=o(function(t){return i(r(t,a))});t.exports=s},61293:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return tp}});var r,o,i,a,s=n(80218),c=n(90438),l=n(15908),u=n(22790),f=n(10462),d=n.n(f),v=n(51909),h=n(2265),p=n(22170),y=n.n(p),g=n(12916),m=n.n(g),w=n(22426),b=n.n(w),A=n(56800),O=n.n(A),I=n(48755),x=n(54887),C=n(60229),k=n.n(C),j=n(9488),P=n.n(j),S=(r=function t(e,n){(function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")})(this,t),this.viewer=e,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1},o=[{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}},{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new(b()).Point(0,0);var t=this.viewer.viewport.getBoundsNoRotateWithMargins(!0);this.viewportOrigin.x=t.x,this.viewportOrigin.y=t.y*this.imgAspectRatio,this.viewportWidth=t.width,this.viewportHeight=t.height*this.imgAspectRatio;var e=this.viewer.world.getItemAt(0);e&&(this.imgWidth=e.source.dimensions.x,this.imgHeight=e.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(t){var e=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var r=n.viewportToImageZoom(e),o=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,i=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(o,i),this.context2d.scale(r,r);var a=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*a.x,0),this.context2d.scale(-1,1));var s=this.viewer.viewport.getRotation();0!==s&&(this.context2d.translate(a.x,a.y),this.context2d.rotate(s*Math.PI/180),this.context2d.translate(-1*a.x,-1*a.y)),t(),this.context2d.setTransform(1,0,0,1,0,0)}}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(r.key),r)}}(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),r);function T(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return R(t,void 0);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,void 0):void 0}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var E=(i=function t(e){var n=e.resource,r=e.palette,o=e.zoomRatio,i=e.offset,a=e.selected,s=e.hovered;(function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")})(this,t),this.resource=n,this.palette=r,this.zoomRatio=o,this.offset=i,this.selected=a,this.hovered=s},a=[{key:"toContext",value:function(t){this.context=t,this.resource.svgSelector?this.svgContext():this.resource.fragmentSelector&&this.fragmentContext()}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgContext",value:function(){var t,e=this;0!==(t=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&T(this.svgPaths).forEach(function(n){e.context.save(),e.context.translate(e.offset.x,e.offset.y);var r=new Path2D(n.attributes.d.nodeValue);e.context.strokeStyle=e.color,n.attributes["stroke-dasharray"]&&e.context.setLineDash(n.attributes["stroke-dasharray"].nodeValue.split(","));var o={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(o).forEach(function(t){n.attributes[t]&&(e.context[o[t]]=n.attributes[t].nodeValue)}),e.context.lineWidth/=e.zoomRatio,(e.selected||e.hovered)&&(e.context.strokeStyle=t.strokeStyle||t.fillStyle),n.attributes["stroke-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["stroke-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.stroke(r),n.attributes.fill&&"none"!==n.attributes.fill.nodeValue&&(n.attributes["fill-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["fill-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.fill(r)),e.context.restore()})}},{key:"fragmentContext",value:function(){var t,e,n,r=this,o=this.resource.fragmentSelector;o[0]+=this.offset.x,o[1]+=this.offset.y,t=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(t).forEach(function(e){r.context[e]=t[e]}),0!==t.globalAlpha&&(t.fillStyle?(e=this.context).fillRect.apply(e,T(o)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,T(o))),this.context.restore())}},{key:"svgPaths",get:function(){return new DOMParser().parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(r.key),r)}}(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),i);function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){var r,o;r=e,o=n[e],(r=U(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function D(t){return function(t){if(Array.isArray(t))return V(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||z(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||z(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){if(t){if("string"==typeof t)return V(t,e);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(t,e):void 0}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,U(r.key),r)}}function U(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function B(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(B=function(){return!!t})()}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t,e){return(N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){var e,n;function r(t){var e,n,o;return!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,r),n=r,o=[t],n=F(n),(e=function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,B()?Reflect.construct(n,o||[],F(this).constructor):n.apply(this,o))).ref=h.createRef(),e.osdCanvasOverlay=null,e.updateCanvas=function(){},e.onUpdateViewport=e.onUpdateViewport.bind(e),e.onCanvasClick=e.onCanvasClick.bind(e),e.onCanvasMouseMove=y()(e.onCanvasMouseMove.bind(e),10),e.onCanvasExit=e.onCanvasExit.bind(e),e}return!function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(r,t),e=[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(t){var e=this.props,n=e.drawAnnotations,o=e.drawSearchAnnotations,i=e.annotations,a=e.searchAnnotations,s=e.hoveredAnnotationIds,c=e.selectedAnnotationId,l=e.highlightAllAnnotations,u=e.viewer;this.initializeViewer();var f=!r.annotationsMatch(i,t.annotations),d=!r.annotationsMatch(a,t.searchAnnotations),v=P()(s,t.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&v&&(s.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var h=c!==t.selectedAnnotationId,p=n!==t.drawAnnotations||o!==t.drawSearchAnnotations||l!==t.highlightAllAnnotations;(d||f||h||v||p)&&(this.updateCanvas=this.canvasUpdateCallback(),u.forceRedraw())}},{key:"componentWillUnmount",value:function(){var t=this.props.viewer;t.removeHandler("canvas-click",this.onCanvasClick),t.removeHandler("canvas-exit",this.onCanvasExit),t.removeHandler("update-viewport",this.onUpdateViewport),t.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(t){var e=this,n=this.props.canvasWorld,r=t.position,o=t.eventSource.viewport.pointFromPixel(r),i=n.canvasAtPoint(o);if(i){var a=H(n.canvasToWorldCoordinates(i.id),4),s=(a[0],a[1],a[2]),c=a[3],l=this.annotationsAtPoint(i,o);if(l.length>0&&(t.preventDefaultAction=!0),1===l.length)this.toggleAnnotation(l[0].id);else if(l.length>0){var u=function(t){var n=Math.PI/180;return function(r){for(var a=0,s=0;s<360;s+=1){var c=Math.cos(s*n)*t+o.x,l=Math.sin(s*n)*t+o.y;e.isAnnotationAtPoint(r,i,{x:c,y:l})&&(a+=1)}return{anno:r,score:a}}},f=[],d=1;for(f=k()(l.map(u(d)),"score");d<Math.max(s,c)&&f[0].score===f[1].score;)d*=2,f=k()(l.map(u(d)),"score");this.toggleAnnotation(f[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(t){var e=this.props,n=e.annotations,r=e.canvasWorld,o=e.hoverAnnotation,i=e.hoveredAnnotationIds,a=e.searchAnnotations,s=e.viewer,c=e.windowId;if(0!==n.length||0!==a.length){var l=t.position,u=s.viewport.pointFromPixel(l),f=r.canvasAtPoint(u);if(!f){o(c,[]);return}var d=this.annotationsAtPoint(f,u);P()(i,d.map(function(t){return t.id})).length>0&&o(c,d.map(function(t){return t.id}))}}},{key:"onCanvasExit",value:function(t){var e=this.props,n=e.hoverAnnotation,r=e.windowId;this.onCanvasMouseMove.cancel(),n(r,[])}},{key:"onUpdateViewport",value:function(t){this.updateCanvas()}},{key:"initializeViewer",value:function(){var t=this.props.viewer;t&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new S(t,this.ref),t.addHandler("canvas-click",this.onCanvasClick),t.addHandler("canvas-exit",this.onCanvasExit),t.addHandler("update-viewport",this.onUpdateViewport),t.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var t=this;return function(){t.osdCanvasOverlay.clear(),t.osdCanvasOverlay.resize(),t.osdCanvasOverlay.canvasUpdate(t.renderAnnotations.bind(t))}}},{key:"isAnnotationAtPoint",value:function(t,e,n){var r=H(this.props.canvasWorld.canvasToWorldCoordinates(e.id),2),o=r[0],i=r[1],a=n.x-o,s=n.y-i;if(t.svgSelector){var c=this.osdCanvasOverlay.context2d;return D(new E({resource:t}).svgPaths).some(function(t){return c.isPointInPath(new Path2D(t.attributes.d.nodeValue),a,s)})}if(t.fragmentSelector){var l=H(t.fragmentSelector,4),u=l[0],f=l[1],d=l[2],v=l[3];return u<=a&&a<=u+d&&f<=s&&s<=f+v}return!1}},{key:"annotationsAtPoint",value:function(t,e){var n=this,r=this.props,o=r.annotations,i=r.searchAnnotations,a=[].concat(D(o),D(i));return d()(a.map(function(t){return t.resources})).filter(function(r){return t.id===r.targetId&&n.isAnnotationAtPoint(r,t,e)})}},{key:"toggleAnnotation",value:function(t){var e=this.props,n=e.selectedAnnotationId,r=e.selectAnnotation,o=e.deselectAnnotation,i=e.windowId;n===t?o(i,t):r(i,t)}},{key:"annotationsToContext",value:function(t,e){var n=this.props,r=n.highlightAllAnnotations,o=n.hoveredAnnotationIds,i=n.selectedAnnotationId,a=n.canvasWorld,s=n.viewer,c=this.osdCanvasOverlay.context2d,l=s.viewport.getZoom(!0)/s.viewport.getMaxZoom();t.forEach(function(t){t.resources.forEach(function(t){if(a.canvasIds.includes(t.targetId)){var n=a.offsetByCanvas(t.targetId);new E({hovered:o.includes(t.id),offset:n,palette:W(W({},e),{},{default:W(W({},e.default),!r&&e.hidden)}),resource:t,selected:i===t.id,zoomRatio:l}).toContext(c)}})})}},{key:"renderAnnotations",value:function(){var t=this.props,e=t.annotations,n=t.drawAnnotations,r=t.drawSearchAnnotations,o=t.searchAnnotations,i=t.palette;r&&this.annotationsToContext(o,i.search),n&&this.annotationsToContext(e,i.annotations)}},{key:"render",value:function(){var t=this.props.viewer;return t?x.createPortal(h.createElement("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},h.createElement("canvas",null)),t.canvas):h.createElement(h.Fragment,null)}}],n=[{key:"annotationsMatch",value:function(t,e){return!t&&!e||(!t||!!e)&&(!!t||!e)&&(0===t.length&&0===e.length||t.length===e.length&&t.every(function(t,n){var r=t.resources.map(function(t){return t.id}),o=e[n].resources.map(function(t){return t.id});return 0===r.length&&0===o.length||r.length===o.length&&!!(t.id===e[n].id&&m()(r,o))}))}}],e&&_(r.prototype,e),n&&_(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}(h.Component);Z.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var $=n(89187),J=n(21242),X=n(76893),q=n(32571),Y=n(32080),G=n(53883),L=n(42588),K={deselectAnnotation:$.D6,hoverAnnotation:$.G3,selectAnnotation:$.XD},Q=(0,s.qC)((0,l.Z)(),(0,c.$j)(function(t,e){var n=e.windowId;return{annotations:(0,J.A7)(t,{windowId:n}),canvasWorld:(0,X.B)(t,{windowId:n}),drawAnnotations:(0,q.iE)(t).window.forceDrawAnnotations||(0,Y.ig)(t,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:(0,q.iE)(t).window.forceDrawAnnotations||(0,Y.ig)(t,{content:"search",windowId:n}).length>0,highlightAllAnnotations:(0,G.Jj)(t,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:(0,G.Jj)(t,{windowId:n}).hoveredAnnotationIds,palette:(0,q.gh)(t).palette,searchAnnotations:(0,L.kM)(t,{windowId:n}),selectedAnnotationId:(0,J.EO)(t,{windowId:n})}},K),(0,v.A)("AnnotationsOverlay"))(Z),tt=n(13793),te={refs:{},set:function(t,e){this.refs[t]=e}};function tn(t,e,n){if(tc())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&tu(o,n.prototype),o}function tr(t){return function(t){if(Array.isArray(t))return to(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return to(t,void 0);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?to(t,void 0):void 0}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function to(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ti(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ta(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ti(Object(n),!0).forEach(function(e){var r,o;r=e,o=n[e],(r=ts(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ti(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ts(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function tc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(tc=function(){return!!t})()}function tl(t){return(tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tu(t,e){return(tu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var tf=function(t){var e;function n(t){var e,r,o;return!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,n),r=n,o=[t],r=tl(r),(e=function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,tc()?Reflect.construct(r,o||[],tl(this).constructor):r.apply(this,o))).state={viewer:void 0},e.ref=h.createRef(),e.apiRef=h.createRef(),te.set(t.windowId,e.apiRef),e.onCanvasMouseMove=y()(e.onCanvasMouseMove.bind(e),10),e.onViewportChange=e.onViewportChange.bind(e),e.zoomToWorld=e.zoomToWorld.bind(e),e}return!function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tu(t,e)}(n,t),e=[{key:"componentDidMount",value:function(){var t=this.props,e=t.osdConfig,n=t.t,r=t.windowId;if(this.ref.current){var o=new(b())(ta({id:this.ref.current.id},e)),i=o.canvas&&o.canvas.firstElementChild;i&&(i.setAttribute("role","img"),i.setAttribute("aria-label",n("digitizedView")),i.setAttribute("aria-describedby","".concat(r,"-osd"))),this.apiRef.current=o,this.setState({viewer:o}),o.addHandler("animation-finish",this.onViewportChange),o.innerTracker&&(o.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(t,e){var n=this.props,r=n.viewerConfig,o=n.canvasWorld,i=this.state.viewer;if(this.apiRef.current=i,void 0===e.viewer){r&&(r.zoom=r.zoom||i.viewport.imageToViewportZoom(1),i.viewport.panTo(r,!0),i.viewport.zoomTo(r.zoom,r,!0),void 0!==r.degrees&&i.viewport.setRotation(r.degrees),void 0!==r.flip&&i.viewport.setFlip(r.flip)),this.addAllImageSources(!r);return}if(this.infoResponsesMatch(t.infoResponses)&&this.nonTiledImagedMatch(t.nonTiledImages)){if(m()(o.layers,t.canvasWorld.layers)){if(r!==t.viewerConfig){var a=i.viewport;(r.x!==a.centerSpringX.target.value||r.y!==a.centerSpringY.target.value)&&a.panTo(r,!1),r.zoom!==a.zoomSpring.target.value&&a.zoomTo(r.zoom,r,!1),r.rotation!==a.getRotation()&&a.setRotation(r.rotation),r.flip!==a.getFlip()&&a.setFlip(r.flip)}}else this.refreshTileProperties()}else{i.close();var s=!m()(o.canvasIds,t.canvasWorld.canvasIds);this.addAllImageSources(s||!r)}}},{key:"componentWillUnmount",value:function(){var t=this.state.viewer;t.innerTracker&&t.innerTracker.moveHandler===this.onCanvasMouseMove&&(t.innerTracker.moveHandler=null),t.removeAllHandlers(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(t){this.state.viewer.raiseEvent("mouse-move",t)}},{key:"onViewportChange",value:function(t){var e=this.props,n=e.updateViewport,r=e.windowId,o=t.eventSource.viewport;n(r,{flip:o.getFlip(),rotation:o.getRotation(),x:Math.round(o.centerSpringX.target.value),y:Math.round(o.centerSpringY.target.value),zoom:o.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var t=this,e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],n=this.props,r=n.nonTiledImages,o=n.infoResponses;Promise.all(o.map(function(e){return t.addTileSource(e)}),r.map(function(e){return t.addNonTiledImage(e)})).then(function(){(o[0]||r[0])&&(e&&t.zoomToWorld(),t.refreshTileProperties())})}},{key:"addNonTiledImage",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer,r=t.getProperty("type"),o=t.getProperty("format")||"";return"Image"===r||"dctypes:Image"===r||o.startsWith("image/")?new Promise(function(r,o){n||o(),n.addSimpleImage({error:function(t){return o(t)},fitBounds:tn(b().Rect,tr(e.contentResourceToWorldCoordinates(t))),index:e.layerIndexOfImageResource(t),opacity:e.layerOpacityOfImageResource(t),success:function(t){return r(t)},url:t.id})}):Promise.resolve()}},{key:"addTileSource",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer;return new Promise(function(r,o){n||o();var i=ta({},t.json),a=e.contentResource(t.id);a&&n.addTiledImage({error:function(t){return o(t)},fitBounds:tn(b().Rect,tr(e.contentResourceToWorldCoordinates(a))),index:e.layerIndexOfImageResource(a),opacity:e.layerOpacityOfImageResource(a),success:function(t){return r(t)},tileSource:i})})}},{key:"refreshTileProperties",value:function(){for(var t=this.props.canvasWorld,e=this.state.viewer.world,n=[],r=0;r<e.getItemCount();r+=1)n.push(e.getItemAt(r));n.forEach(function(n,r){var o=t.contentResource(n.source["@id"]||n.source.id);if(o){var i=t.layerIndexOfImageResource(o);r!==i&&e.setItemIndex(n,i),n.setOpacity(t.layerOpacityOfImageResource(o))}})}},{key:"fitBounds",value:function(t,e,n,r){var o=!(arguments.length>4)||void 0===arguments[4]||arguments[4];this.state.viewer.viewport.fitBounds(new(b()).Rect(t,e,n,r),o)}},{key:"infoResponsesMatch",value:function(t){var e=this.props.infoResponses;return 0===e.length&&0===t.length||e.length===t.length&&e.every(function(e,n){return!!t[n]&&!!e.json&&!!t[n].json&&e.tokenServiceId===t[n].tokenServiceId&&(!!e.json["@id"]&&e.json["@id"]===t[n].json["@id"]||!!e.json.id&&e.json.id===t[n].json.id)})}},{key:"nonTiledImagedMatch",value:function(t){var e=this.props.nonTiledImages;return 0===e.length&&0===t.length||e.some(function(e,n){return!!t[n]&&e.id===t[n].id})}},{key:"zoomToWorld",value:function(){var t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],e=this.props.canvasWorld;this.fitBounds.apply(this,tr(e.worldBounds()).concat([t]))}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=e.classes,o=e.label,i=e.t,a=e.windowId,s=e.drawAnnotations,c=this.state.viewer,l=h.Children.map(n,function(e){return h.cloneElement(e,{zoomToWorld:t.zoomToWorld})});return h.createElement(h.Fragment,null,h.createElement("section",{className:O()((0,I.Z)("osd-container"),r.osdContainer),id:"".concat(a,"-osd"),ref:this.ref,"aria-label":i("item",{label:o}),"aria-live":"polite"},s&&h.createElement(Q,{viewer:c,windowId:a}),l,h.createElement(tt.M,Object.assign({viewer:c},ta(ta({},this.props),{},{children:null})))))}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ts(r.key),r)}}(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}(h.Component);tf.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var td=n(81640),tv=n(22180),th={updateViewport:td.WH},tp=(0,s.qC)((0,u.Z)({osdContainer:{flex:1,position:"relative"}}),(0,l.Z)(),(0,c.$j)(function(t,e){var n=e.windowId,r=(0,X.B)(t,{windowId:n}),o=(0,tv.k5)(t),i=d()(r.canvases.map(function(t){return t.imageServiceIds}));return{canvasWorld:r,drawAnnotations:(0,q.iE)(t).window.forceDrawAnnotations||(0,Y.ig)(t,{content:"annotations",windowId:n}).length>0||(0,Y.ig)(t,{content:"search",windowId:n}).length>0,infoResponses:i.map(function(t){return o[t]}).filter(function(t){return void 0!==t&&!1===t.isFetching&&void 0===t.error}),label:(0,tv.vt)(t,{canvasId:((0,tv.Pm)(t,{windowId:n})||{}).id,windowId:n}),nonTiledImages:(0,tv.Fg)(t,{windowId:n}),osdConfig:(0,q.iE)(t).osdConfig,viewerConfig:(0,G.gA)(t,{windowId:n})}},th),(0,v.A)("OpenSeadragonViewer"))(tf)}}]);